#!/usr/bin/env python
import sys
import time

from controller.palapi import CommHandlerCmd, CommException

if __name__ == "__main__":
    comm = CommHandlerCmd()
    comm.parse_args()
    comm.verbose = 2

    try:
        comm.send_cmd("sched delete backup", read_response=True,
                      skip_on_wrong_state=False)
        time.sleep(65)
        comm.send_cmd("sched add 0 0 * * * backup", read_response=True,
                      skip_on_wrong_state=False)

        comm.send_cmd("ziplogs", read_response=True, skip_on_wrong_state=True)
        print "ziplogs reply:", comm.response

        comm.send_cmd("backup", read_response=True, skip_on_wrong_state=True)
        print "backup reply:", comm.response
        comm.send_cmd("cleanup", read_response=True, skip_on_wrong_state=True)
        print "cleanup data:", comm.response
    except CommException as ex:
        print >> sys.stderr, str(ex)

    sys.exit(0)
